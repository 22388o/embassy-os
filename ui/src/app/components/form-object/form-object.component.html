<ion-item-group [formGroup]="formGroup">
  <div *ngFor="let entry of formGroup.controls | keyvalue : asIsOrder">
    <!-- {{ console.log(entry.value) }}
    {{ console.log('OBJECT SPEC', objectSpec) }} -->
    <ng-container *ngIf="unionSpec && entry.key === 'type'">
        <p class="input-label">Type</p>
        <ion-item color="dark">
          <ion-label>Type</ion-label>
          <ion-select slot="end" placeholder="Select" formControlName="type" [selectedText]="unionSpec.tag.variantNames[entry.value.value]" (ionChange)="updateUnion($event)">
            <ion-select-option *ngFor="let option of Object.keys(unionSpec.variants)" [value]="option">
              {{ unionSpec.tag.variantNames[option] }}
            </ion-select-option>
          </ion-select>
        </ion-item>
    </ng-container>
    <ng-container *ngIf="objectSpec[entry.key] as spec">
      <!-- string -->
      <ng-container *ngIf="spec.type === 'string'">
        <p class="input-label">{{ spec.name }}</p>
        <ion-item color="dark">
          <ion-input [placeholder]="'Enter ' + spec.name" [formControlName]="entry.key"></ion-input>
        </ion-item>
      </ng-container>
      <!-- number -->
      <ng-container *ngIf="spec.type === 'number'">
        <p class="input-label">{{ spec.name }}</p>
        <ion-item color="dark">
          <ion-input type="tel" [placeholder]="'Enter ' + spec.name" [formControlName]="entry.key"></ion-input>
        </ion-item>
      </ng-container>
      <!-- boolean -->
      <ng-container *ngIf="spec.type === 'boolean'">
        <p class="input-label">{{ spec.name }}</p>
        <ion-item color="dark">
          <ion-label>{{ spec.name }}</ion-label>
          <ion-toggle style="--background: var(--ion-color-step-600);" slot="end" color="light" [formControlName]="entry.key"></ion-toggle>
        </ion-item>
      </ng-container>
      <!-- enum -->
      <ng-container *ngIf="spec.type === 'enum'">
        <p class="input-label">{{ spec.name }}</p>
        <ion-item color="dark">
          <ion-label>{{ spec.name }}</ion-label>
          <ion-select slot="end" placeholder="Select" [formControlName]="entry.key" [selectedText]="spec.valueNames[formGroup.get(entry.key).value]">
            <ion-select-option *ngFor="let option of spec.values" [value]="option">
              {{ spec.valueNames[option] }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ng-container>
      <!-- object -->
      <ng-container *ngIf="spec.type === 'object'">
        <ion-item-divider>
          {{ spec.name }}
        </ion-item-divider>
        <div class="nested-wrapper">
          <form-object [objectSpec]="spec.spec" [formGroup]="entry.value"></form-object>
        </div>
      </ng-container>
      <!-- union -->
      <ng-container *ngIf="spec.type === 'union'">
        <ion-item-divider>
          {{ spec.name }}
        </ion-item-divider>
        <div class="nested-wrapper">
          <form-object [objectSpec]="spec.variants[entry.value.controls.type.value]" [formGroup]="entry.value" [unionSpec]="spec"></form-object>
        </div>
      </ng-container>
      <!-- list (not enum) -->
      <ng-container *ngIf="spec.type === 'list' && spec.subtype !== 'enum'">
        <ng-container *ngIf="formGroup.get(entry.key) as formArr" [formArrayName]="entry.key">
          <ion-item-divider>
            {{ spec.name }}
          </ion-item-divider>
          <div class="nested-wrapper">
            <ion-item-group>
              <div *ngFor="let ip of formArr.controls; let i = index;" class="ion-padding-top">
                <ion-item color="dark">
                  <ion-input [placeholder]="'Enter ' + spec.name" [formControlName]="i"></ion-input>
                  <ion-button slot="end" color="danger" (click)="presentAlertDelete(entry.key, i)">
                    <ion-icon slot="icon-only" name="close-outline"></ion-icon>
                  </ion-button>
                </ion-item>
                <ng-container *ngFor="let validation of formService.validationMessages[entry.key + '/' + i]">
                  <p style="font-size: small;" *ngIf="ip.hasError(validation.type) && (ip.dirty || ip.touched)">
                    <ion-text color="danger">{{ validation.message }}</ion-text>
                  </p>
                </ng-container>
              </div>
            </ion-item-group>
            <div style="text-align: right; padding-top: 12px;">
              <ion-button style="text-align: right;" (click)="addListItem(entry.key)">
                <ion-icon slot="start" name="add"></ion-icon>
                New
              </ion-button>
            </div>
          </div>
        </ng-container>
      </ng-container>
      <!-- list (enum) -->
      <ng-container *ngIf="spec.type === 'list' && spec.subtype === 'enum'">
        <ng-container *ngIf="formGroup.get(entry.key) as formArr" [formArrayName]="entry.key">
          <p class="input-label">{{ spec.name }}</p>
          <ion-item color="dark">
            <ion-label>{{ spec.name }}</ion-label>
            <ion-select slot="end" multiple placeholder="Select" [value]="formArr.value" [selectedText]="getEnumListDisplay(formArr.value, spec.spec)" (ionChange)="updateEnumList(entry.key, formArr.value, $event)">
              <ion-select-option *ngFor="let option of spec.spec.values" [value]="option">
                {{ spec.spec.valueNames[option] }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ng-container>
      </ng-container>
      <ng-container *ngFor="let validation of formService.validationMessages[entry.key]">
        <p style="font-size: small;" *ngIf="formGroup.get(entry.key).hasError(validation.type) && (formGroup.get(entry.key).dirty || formGroup.get(entry.key).touched)">
          <ion-text color="danger">{{ spec.name }}: {{ validation.message }}</ion-text>
        </p>
      </ng-container>
    </ng-container>
  </div>
</ion-item-group>